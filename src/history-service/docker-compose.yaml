version: '3.8'

services:
  history-service:
      build: .
      container_name: history-service
      environment:
        DATABASE_URL: ${DATABASE_URL}
        RABBITMQ_URL: ${RABBITMQ_URL}
      volumes:
        - ./:/app
      working_dir: /app
      command: npm run start:prod
      ports:
        - "3005:3005"
      networks:
        - postgres-net
        - rabbitmq-net
        - nginx-gateway
  history-worker:
    build: .
    container_name: history-worker
    command: npm run start:worker:prod
    environment:
      NODE_ENV: production
      RABBITMQ_URL: ${RABBITMQ_URL}
      DATABASE_URL: ${DATABASE_URL}
    networks:
      - rabbitmq-net
      - postgres-net

networks:
  postgres-net:
    external: true
  rabbitmq-net:
    external: true
  nginx-gateway:
    external: true

